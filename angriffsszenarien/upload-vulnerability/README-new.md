# file upload vulnerabilities â€” web shells through the front door

### payloads

{% embed url="https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php" %}

or simple web shell: `<?php echo system($_GET["cmd"]); ?>`

* directory scanning: find upload folders/assets/file storage
* source code review of upload scripts

### overwriting existing files

file uploads must check for existing files to prevent overwrites.

common protections:
* automatic renaming (random values, timestamps)  
* filename conflict detection with user notification

## filtering and defense mechanisms

file validation methods you'll encounter:

**extension validation**
blacklist/whitelist file extensions like `.php`, `.php3`, `.py`
defines what's allowed (whitelist) or what's blocked (blacklist)

**file type filtering**
similar to extension validation:

- **MIME validation** - checks `Content-Type` header in HTTP request
  format: `<type>/<subtype>` like `image/png`
  easily bypassed since it only checks the declared type, not actual content

- **magic number/file signature validation** - checks first bytes of file
  each file type has unique byte signatures
  comprehensive list: https://en.wikipedia.org/wiki/List_of_file_signatures

**file size filtering**
prevents large uploads to protect server resources
can block payloads if limits are too restrictive
example: PHP reverse shell (5.4 KB) blocked if limit is 2 KB

## bypass strategies

**extension bypasses**
- double extensions: `shell.php.jpg`
- case variations: `.PHP`, `.pHp`
- alternative extensions: `.php3`, `.php4`, `.php5`, `.phtml`
- null byte injection: `shell.php%00.jpg` (older systems)

**MIME type bypasses**
- change `Content-Type` header to allowed type
- use burp suite proxy to modify requests

**magic number bypasses**
- prepend valid file headers to payload
- example: add PNG header `\x89PNG\r\n\x1a\n` before PHP code

**size limit bypasses**
- minified payloads
- staged uploads (small initial payload downloads larger one)
- use shorter variable names and remove comments

**content filtering bypasses**
- obfuscation techniques
- encoding payloads (base64, hex)
- string concatenation to avoid keyword detection

## exploitation workflow

1. identify upload functionality
2. test file type restrictions
3. attempt bypass techniques
4. upload test file with safe payload
5. locate uploaded file (directory scanning)
6. execute payload via direct access
7. upgrade to full shell if needed

## notes

upload vulnerabilities are goldmines when found. even basic filtering can often be bypassed with creativity. always check for file execution contexts - sometimes uploads are stored but never executed.
